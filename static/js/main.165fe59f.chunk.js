(this["webpackJsonpreact-rumbletalk"]=this["webpackJsonpreact-rumbletalk"]||[]).push([[0],{47:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(22),s=a.n(o),i=a(5),c=a(6),l=a(7),u=a(10),h=a(9),d=a(3),f=a(4),m=a.n(f),g=a(12),p=a(8),v=a(13),b=a.n(v),w=a(0),j=r.a.forwardRef((function(e,t){var a=e.style,n=e.src,r=e.onLoad;return Object(w.jsx)("iframe",{title:"iframe",frameBorder:"0",allow:"microphone; camera; fullscreen; autoplay",allowtransparency:"true",ref:t,style:{width:a&&a.width?"".concat(a.width,"px"):"100%",height:a&&a.height?"".concat(a.height,"px"):"100%"},src:n,onLoad:r})})),O="https://d1pfint8izqszg.cloudfront.net",C=r.a.forwardRef((function(e,t){var a=e.side,n=e.isMobile,r=e.openChat,o=e.toggleFloatingChat,s=e.chatBubble,i=e.image,c=e.onImageLoad,l=e.onIframeLoad,u=e.counter,h=e.counters,d=e.userCount,f=e.floatingChat,m=e.width,g=e.height,p=e.src;return Object(w.jsxs)("div",{className:"rumbletalk-floating rumbletalk-floating-".concat(a),onClick:n?r:o,style:{width:"".concat(s.width,"px"),height:"".concat(s.height,"px")},children:[Object(w.jsx)("img",{alt:"Click to join the conversation",title:"Click to join the conversation",src:i,className:a,onLoad:c}),u&&Object(w.jsxs)("div",{className:"counter-div",style:{top:"".concat(h.top,"px"),left:"".concat(h.left,"px")},children:[!n&&!d&&Object(w.jsx)("img",{alt:"loading",src:"".concat(O,"/images/toolbar/mini_wait.gif")}),!n&&d]}),!n&&Object(w.jsxs)("div",{className:"chat-div chat-div-".concat(f.className," chat-div-").concat(a),style:f.style,children:[Object(w.jsx)("img",{className:"close-button",alt:"close",src:"".concat(O,"/images/c.png"),style:{left:"left"===a?"auto":"-8px",right:"right"===a?"auto":"-8px"},onClick:function(e){return o(e)}}),Object(w.jsx)(j,{ref:t,style:{width:m,height:g},src:p,onLoad:l})]})]})})),y="https://",x="https://rumbletalk.com",k="client/service.php?hash=",I="pm.1",L="pm.2",R="pm.3",E="pm.4",N="pm.5",M="pm.6",B="pm.7",S=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).loadIframe=Object(g.a)(m.a.mark((function e(){var t,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.hash,e.next=3,b.a.get("".concat(x,"/").concat(k).concat(t));case 3:a=e.sent,n.server=a.data.address,n.setState({src:"https://".concat(n.server,"/").concat(t,"/#").concat(window.location.href)});case 6:case"end":return e.stop()}}),e)}))),n.addListeners=function(){window.addEventListener("message",n.info,!1),!n.mobile&&n.props.floating&&window.addEventListener("keyup",n.escClose,!1)},n.escClose=function(e){"Escape"===e.key&&n.toggleFloatingChat(null,!0)},n.info=function(e){isFinite(e.data)?(clearInterval(n.messageInterval),n.props.counter&&n.setState({userCount:e.data.toString()})):"object"===typeof e.data&&e.data.reload&&n.reload()},n.reload=Object(g.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.get("".concat(x,"/").concat(k).concat(n.props.hash,"}"));case 3:t=e.sent,n.server=t.data.address,n.iframeRef.current instanceof HTMLIFrameElement?n.setState({src:"".concat(y).concat(n.server,"/").concat(n.hash,"/#").concat(window.location.href)}):n.iframeRef.current.location.href=n.server,e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])}))),n.iframeHasLoaded=function(){n.messageInterval=setInterval(n.query,1e3)},n.query=function(){try{var e,t;n.iframeRef.current.nativeElement instanceof HTMLIFrameElement?(e=n.iframeRef.current.contentWindow,t=y+n.server):(e=n.iframeRef.current,t=x),e.postMessage("toolbar",t)}catch(a){}},n.toggleFloatingChat=function(e,t){e&&e.stopPropagation();var a=n.state.floatingChat;if("out"===a.className){if(t)return;a.className="in",a.style=Object(d.a)(Object(d.a)({},a),{},{overflow:"visible"})}else a.className="out",a.style=Object(d.a)(Object(d.a)({},a),{},{overflow:"hidden"});n.setState({floatingChat:a})},n.openChat=function(){var e,t="".concat(x,"client/chat.php?").concat(n.hash,"/#").concat(window.location.href),a=n.iframeRef.current;if(a)a.nativeElement.focus();else{var r=window.open(t);e=setInterval((function(){r.closed&&clearInterval(e)}),100)}},n.handleImageLoad=function(e){var t=n.state,a=t.floatingChat,r=t.chatBubble;r.height=e.target.height,r.width=e.target.width,a.style=Object(d.a)(Object(d.a)({},a.style),{},{bottom:"".concat(e.target.height,"px")}),n.setState({floatingChat:a,chatBubble:r})},n.login=function(e){var t={};if(t.username=n.trim(e.username),!n.validateUsername(t.username))throw new Error('Error: invalid username in "login" function');if(e.password){if(!n.validatePassword(e.password))throw new Error('Error: invalid password in "login" function');t.password=e.password}if(e.image){if(!n.validateUrl(e.image))throw new Error('Error: invalid image in "login" function');t.image=e.image}t.type=R,t.hash=e.hash,t.forceLogin=e.forceLogin;var a=setInterval((function(){n.postMessage(t)}),1e3);window.addEventListener("message",function t(n){if(this.validateChatOrigin(n.origin)||console.log('Error: invalid origin in "login" function'),"object"!==typeof n.data&&console.log("Error: invalid data received in RumbleTalk SDK: ".concat(n.data)),n.data.hash!==e.hash)throw new Error("Error: chat hash mismatch");n.data.type!==E&&n.data.type!==N||(clearInterval(a),window.removeEventListener("message",t),e.callback({status:n.data.type,message:n.data.type===E?"success":"already logged in"}))}.bind(Object(p.a)(n)),!1)},n.logout=function(e){var t={type:M,hash:e.hash};e.userId&&(t.userId=e.userId),e.username&&(t.username=e.username),n.postMessage(t)},n.logoutCB=function(e){var t=setInterval((function(){n.postMessage({type:I})}),1e3);window.addEventListener("message",(function(a){n.validateChatOrigin(a.origin)&&"object"===typeof a.data&&a.data.hash===e.hash&&(a.data.type!==L?a.data.type===I&&e.callback(a.data.reason):clearInterval(t))}),!1)},n.openPrivateChat=function(e){var t={type:B,hash:e.hash};e.userId&&(t.userId=e.userId),e.username&&(t.username=e.username),n.postMessage(t)},n.postMessage=function(e){try{(n.iframeRef.current instanceof HTMLIFrameElement?n.iframeRef.current.contentWindow:n.iframeRef.current).postMessage(e,"".concat(y).concat(n.server))}catch(t){console.log(t.name,t.message)}},n.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},n.validateUsername=function(e){return!/^-?\d+$/.test(e)&&e.length<64},n.validatePassword=function(e){return 0<e.length&&e.length<51},n.validateUrl=function(e){return/(https?:)?\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/.test(e)},n.validateChatOrigin=function(e){return/^https:\/\/.+\.rumbletalk\.(net|com)(:4433)?$/.test(e)},n.state={counters:{top:14,left:23},src:null,userCount:null,floatingChat:{className:"out",style:{overflow:"hidden",bottom:"auto"}},chatBubble:{height:"auto",width:"auto"}},n.server=null,n.messageInterval=null,n.iframeRef=r.a.createRef();var o=navigator.userAgent.toUpperCase();return n.mobile=-1!==o.indexOf("MOBILE")||-1!==o.indexOf("ANDROID")||-1!==o.indexOf("IOS"),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.floating,a=e.counter,n=this.state.counters;if(t&&a){var r=a.split(":");if(2===r.length){var o=Number(r[0]),s=Number(r[1]);isNaN(o)||(n.top=o),isNaN(s)||(n.left=s)}}this.addListeners(),this.setState({counters:n},this.loadIframe)}},{key:"render",value:function(){var e=this.props,t=e.width,a=e.height,n=e.floating,r=this.state.src;return r?n?Object(w.jsx)(C,Object(d.a)(Object(d.a)(Object(d.a)({},this.props),this.state),{},{ref:this.iframeRef,isMobile:this.mobile,openChat:this.openChat,toggleFloatingChat:this.toggleFloatingChat,onIframeLoad:this.iframeHasLoaded,onImageLoad:this.handleImageLoad})):Object(w.jsx)("div",{className:"rumbletalk-embed",style:{width:"".concat(t,"px"),height:"".concat(a,"px")},children:Object(w.jsx)(j,{src:r,onLoad:this.iframeHasLoaded,ref:this.iframeRef})}):null}}]),a}(r.a.Component);S.defaultProps={width:700,height:500,floating:!1,side:"right",image:"https://d1pfint8izqszg.cloudfront.net/images/toolbar/toolbar.png"};var T=S,F="ykUIwC4J",P=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleInputChange=function(e,t){n.setState(Object(i.a)({},t,e.target.value))},n.login=function(){var e=n.state,t=e.username,a=e.password;n.rumbleTalkRef.current.login({hash:F,username:t,password:a,callback:function(e){console.log("login callback",e),n.setState({username:"",password:""})}})},n.logout=function(){n.rumbleTalkRef.current.logout({hash:F,username:n.state.username})},n.logoutCB=function(){n.rumbleTalkRef.current.logoutCB({hash:F,username:n.state.username,callback:function(e){return console.log("logout callback",e)}})},n.openPrivateChat=function(){n.rumbleTalkRef.current.openPrivateChat({hash:F,username:n.state.username})},n.state={username:"",password:""},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.rumbleTalkRef=r.a.createRef()}},{key:"render",value:function(){var e=this,t=this.state,a=t.username,n=t.password;return Object(w.jsxs)("div",{className:"main",children:[Object(w.jsx)(T,{floating:!0,hash:F,width:700,height:500,counter:"14:23",ref:this.rumbleTalkRef}),Object(w.jsxs)("div",{className:"form",children:[Object(w.jsx)("input",{type:"text",placeholder:"username",value:a,onChange:function(t){return e.handleInputChange(t,"username")}}),Object(w.jsx)("input",{type:"password",placeholder:"password",value:n,onChange:function(t){return e.handleInputChange(t,"password")}}),Object(w.jsxs)("div",{className:"buttons",children:[Object(w.jsx)("button",{onClick:this.login,children:"Login"}),Object(w.jsx)("button",{onClick:this.logout,children:"Logout"}),Object(w.jsx)("button",{onClick:this.logoutCB,children:"LogoutCB"}),Object(w.jsx)("button",{onClick:this.openPrivateChat,children:"Open Private Chat"})]})]})]})}}]),a}(r.a.Component);s.a.render(Object(w.jsx)(r.a.StrictMode,{children:Object(w.jsx)(P,{})}),document.getElementById("root"))}},[[47,1,2]]]);
//# sourceMappingURL=main.165fe59f.chunk.js.map